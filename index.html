<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0">
  <title>醇风音乐</title>
  <link rel="stylesheet" href="./css/index.css">
</head>

<body>
  <div id="wrap">
    <div class="head">
      <div class="head-top">
        <!-- 按钮 -->
        <h1 class="logo">
          <a href="">
            <img src="./img/logo1.png" alt="">
          </a>
        </h1>
        <!-- 面包屑导航按钮 -->
        <a href="javascript:;" class="menuBtn"></a>
        <!-- 添加一组按钮 -->
        <div class="btns">
          <a href="javascript:;" class="search">搜索</a>
          <a href="javascript:;">登录</a>
          <a href="javascript:;">注册</a>
        </div>
      </div>
      <div class="head-bottom">
        <form method="post">
          <input type="text" placeholder="您喜欢的，我都有...">
          <input type="submit" value="搜索" />
        </form>
      </div>
      <!-- 遮罩层 -->
      <ul class="mask">
        <li><a href="javascript:;">首页</a></li>
        <li><a href="javascript:;">MV</a></li>
        <li><a href="javascript:;">悦单</a></li>
        <li><a href="javascript:;">V傍</a></li>
        <li><a href="javascript:;">音乐</a></li>
        <li><a href="javascript:;">商城</a></li>
        <li><a href="javascript:;">节目</a></li>
        <li><a href="javascript:;">饭团</a></li>
        <li><a href="javascript:;">质询</a></li>
        <li><a href="javascript:;">我的家</a></li>
        <li><a href="javascript:;">App下载</a></li>
        <li><a href="javascript:;">热门应用</a></li>
      </ul>
    </div>
    <!--head end-->
    <!-- 导航条 -->
    <div class="content">
      <div class="nav">
        <ul class="list">
          <li><a href="javascript:;" class="active">首页</a></li>
          <li><a href="javascript:;">MV</a></li>
          <li><a href="javascript:;">悦单</a></li>
          <li><a href="javascript:;">V傍</a></li>
          <li><a href="javascript:;">音乐</a></li>
          <li><a href="javascript:;">商城</a></li>
          <li><a href="javascript:;">节目</a></li>
          <li><a href="javascript:;">饭团</a></li>
          <li><a href="javascript:;">质询</a></li>
          <li><a href="javascript:;">我的家</a></li>
          <li><a href="javascript:;">App下载</a></li>
          <li><a href="javascript:;">热门应用</a></li>
        </ul>
      </div>
      <!-- 轮播图 -->
      <div class="carousel-wrap" needAuto needCarousel>
        <div class="points-wrap"></div>
      </div>
      <!-- 标签tab -->
      <div class="tap-wrap">
        <div class="tap-head">
          <h2>MV主播</h2>
          <span>更多&gt;</span>
        </div>
        <div class="tap-nav">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">内地</a>
          <a href="javascript:;">港台</a>
          <a href="javascript:;">欧美</a>
          <a href="javascript:;">非洲大草原</a>
          <a href="javascript:;">韩国</a>
          <a href="javascript:;">日本</a>
          <!-- 滑动小绿条 -->
          <div class="smallG"></div>
        </div>

        <div class="tap-content">
          <ul class="tap-loading"></ul>
          <ul>
            <li>
              <a href="javascript:;">
                <img src="img/a.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/b.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/c.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/d.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/e.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/f.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>

          </ul>
          <ul class="tap-loading"></ul>
        </div>
      </div>
      <div class="tap-wrap">
        <div class="tap-head">
          <h2>MV主播</h2>
          <span>更多&gt;</span>
        </div>
        <div class="tap-nav">
          <a href="javascript:;">全部</a>
          <a href="javascript:;">内地</a>
          <a href="javascript:;">港台</a>
          <a href="javascript:;">欧美</a>
          <a href="javascript:;">非洲大草原</a>
          <a href="javascript:;">韩国</a>
          <!--滑动小绿条-->
          <div class="smallG"></div>
        </div>
        <div class="tap-content">
          <ul class="tap-loading"></ul>
          <ul>
            <li>
              <a href="javascript:;">
                <img src="img/a.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/b.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/c.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/d.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/e.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>
            <li>
              <a href="javascript:;">
                <img src="img/f.jpg" alt="" />
                <span>泡菜啊！泡菜啊！泡菜啊！
                  泡菜啊！泡菜啊！泡菜啊!
                </span>
              </a>
              <div class="tap-discuss">
                <div class="right">
                  <span></span>
                  <!--小图片 播放次数-->
                  <span>9176</span>
                </div>
                <div class="left">
                  <span></span>
                  <!--小图片 留言次数-->
                  <span>6</span>
                </div>
              </div>
            </li>

          </ul>
          <ul class="tap-loading"></ul>
        </div>
      </div>
      <!--标签tab开始 end-->
    </div>
    <!--content end-->
  </div>
  <script src="./js/webtools.js"></script>
  <script>
    window.onload = function () {
      document.addEventListener("touchstart", function (ev) {
        ev = ev || event;
        ev.preventDefault();
      }, { passive: false });//提前阻止事件触发来兼容新的系统
      // 设置rem适配方案
      // 创建style元素获取布局视口宽度除以16
      // 将style元素追加到head
      ; (function () {
        var styleNode = document.createElement("style");
        var w = document.documentElement.clientWidth / 16;
        styleNode.innerHTML = "html{font-size:" + w + "px!important}";
        document.head.append(styleNode);
      })()
      // 测试数据
      // +(function(){
      //  for(var i=0; i<200;i++){
      //   wrap.innerHTML+="abc<br />"
      //  }
      // })()
      //  通过js实现输入框获取焦点功能
      changeFocus();
      function changeFocus() {
        // 1获取输入框
        var inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']");
        // 2为输入框绑定事件
        inputText.addEventListener("touchstart", function (ev) {
          ev = ev || event;
          //3 当前元素获取焦点
          this.focus()
          //4:阻止事件冒泡
          ev.stopPropagation();
          //5:阻止事件默认行为
          ev.preventDefault();
        })
        //1.2:如果用户触碰其它元素失去焦点
        document.addEventListener("touchstart", (ev) => {
          ev = ev || event;
          // 输入框失去焦点
          inputText.blur();
        })
      } //changeFocus end
      // 遮罩层点击切换效果
      CMCFMenuBtn();
      function CMCFMenuBtn() {
        //1:获取频道按钮元素
        var menuBtn = document.querySelector("#wrap .head .head-top .menuBtn");
        //2:获取遮罩层
        var mask = document.querySelector("#wrap .head .mask");
        //2.1:创建变量保存状态 频道/X
        var isXBtn = false;
        //3:为频道按钮绑定事件 touchstart
        menuBtn.addEventListener("touchstart", function (ev) {
          ev = ev || event;
          //3.1:如果是频道显示遮罩层
          if (isXBtn) {
            webtools.removeClass(menuBtn, "active")
            mask.style.display = "none";//隐藏遮罩层
          } else {
            webtools.addClass(menuBtn, "active");
            mask.style.display = "block";//显示遮罩层
          }
          isXBtn = !isXBtn;
          //3.2:如果是X隐藏遮罩层
          //3.3:修改状态按钮值
          //########解决事件传递
          ev.stopPropagation();
          ev.preventDefault();
        })

        //如果点击其它位置则隐藏
        document.addEventListener("touchstart", function () {
          //4:如果当前是X按钮
          if (isXBtn) {
            //4.1:将遮罩层隐藏效果
            mask.style.display = "none";
            //4.2:将按钮class删除,按钮恢复频道按钮
            webtools.removeClass(menuBtn, "active");
            //4.3:切换状态
            isXBtn = !isXBtn;
          }
        })

        //如果点击遮罩层上不隐藏
        mask.addEventListener("touchstart", function (ev) {
          ev = ev || event;
          ev.stopPropagation();
          ev.preventDefault();
        })

      }//CMCFMenuBtn end
      //任务一:完成遮罩层点击切换效果 end
      // 导航栏滑动
      //任务二:
      //滑屏 start
      drag()
      function drag() {
        //1:获取滑屏区域
        var wrap = document.querySelector("#wrap .content .nav");
        //2:获取滑屏元素
        var item = document.querySelector("#wrap .content .nav .list");
        //3:创建变量保存手指开始位置
        var startX = 0;
        var elementX = 0;
        //4:创建变量保存元素位置
        //5:为滑屏区域绑定事件 start

        //边界判断
        //滑屏区域-滑屏元素=minX
        var minX = wrap.clientWidth - item.offsetWidth;
        wrap.addEventListener("touchstart", function (ev) {
          ev = ev || event;
          var touchC = ev.changedTouches[0];
          startX = touchC.clientX;
          elementX = webtools.css(item, "translateX");
          item.style.transition = "none";


          //获取开始时间与开始位置
          lastTime = new Date().getTime();
          lastPoint = webtools.css(item, "translateX")
          //清除位置差
        })
        //6:为滑屏区域绑定事件 move
        wrap.addEventListener("touchmove", function (ev) {
          ev = ev || event;
          var touchC = ev.changedTouches[0];
          var nowX = touchC.clientX;
          var disX = nowX - startX;
          var translateX = elementX + disX;
          //左侧像皮盘效果(当网页显示第一组内容向右滑)
          //在move 的过程序中
          //每一次move元素移动距离慢慢变小
          //0.5 0.4 0.3 ...
          var vw = document.documentElement.clientWidth;
          if (translateX > 0) {//向右移动到边界
            //scale 拖动距离系数 0.9 0.8..
            var scale = vw / ((vw + translateX) * 1.5);
            //实际移动位置=disX移动距离*系数
            translateX = elementX + disX * scale;
          } else if (translateX < minX) {//向左移动到边界
            var over = minX - translateX;
            //console.log("1:"+over);
            var scale = vw / ((vw + over) * 1.5);
            translateX = elementX + disX * scale;
          }
          webtools.css(item, "translateX", translateX);
          // 获取当前时间点与位置
          var nowTime = new Date().getTime();
          var nowPoint = webtools.css(item, "translateX")
          // console.log("1:"+pointDis)

          // 计算时间差与位置差
          timeDis = nowTime - lastPoint;
          pointDis = nowPoint - lastPoint;

          // 对上一个点覆盖
          lastTime = nowPoint;
          lastPoint = nowPoint;
          // console.log("1:"+pointDis)
        })
        wrap.addEventListener("touchend", function (ev) {//手指抬起橡皮筋弹回
          ev = ev || event;
          // 滑动的速度=距离/时间
          var speed = pointDis / timeDis;
          // 调整速度
          Math.abs(speed) < 0.5 ? 0 : speed;
          var translateX = translateX + speed * 400;



          //1:获取translateX;
          var translateX = webtools.css(item, "translateX");
          //2:添加过渡1s效果 
          item.style.transition = "1s cubic-bezier(0,1.88,1,-0.99) transform";
          //3:如果滑动碰左侧边界 translateX = 0;
          if (translateX > 0) {
            translateX = 0;
            webtools.css(item, "translateX", translateX);
          } else if (translateX < minX) {//4:如果滑动碰右侧边界 translateX = minX;
            translateX = minX;
            webtools.css(item, "translateX", translateX);
          }

        })

      }
      //滑屏 end
      //  快速滑屏
      // 1创建四个变量
      var lastTime = 0;//上一个触发时间
      var lastPoint = 0;//开始位置
      var timeDis = 1;//时间差
      var pointDis = 0; //位置差

      //  点击导航变色
      changeColor()
      function changeColor() {
        // 1:获取列表的父元素
        var list = document.querySelector("#wrap .content .nav .list")
        // 2:获取所以列表中的a元素
        var aNodes = document.querySelectorAll("#wrap .content .nav .list > li a")
        // 3:为父元素绑定事件三个
        list.addEventListener("touchstart", function () {

          this.isMove = false;//默认切换
        });
        list.addEventListener("touchmove", function () {

          this.isMove = true;//切换滑动
        });
        list.addEventListener("touchend", function (ev) {
          if (this.isMove) {
            return;
          }
          ev = ev || event;
          // 清除a的active
          for (var i = 0; i < aNodes.length; i++) {
            webtools.removeClass(aNodes[i], "active")
          }
          // 当前元素添加active
          var touchC = ev.changedTouches[0];

          //  为用户行为添加判断是滑动还是点击切换操作
          //手指列表里的属性touchC.target 触发事件对象
          webtools.addClass(touchC.target, "active")
        });
      }

      swiper();
      function swiper() {
        var arr = ["img/01.jpg", "img/02.jpg", "img/03.jpg", "img/04.jpg", "img/05.jpg"];
        webtools.carousel(arr);
      }

      //17 标签页
      tap()
      function tap() {
        // 获取标签页父元素 .tap-wrap
        // 只需要元素的宽度
        var wrap = document.querySelector("#wrap .content .tap-wrap ")
        // 获取标签页中 content 元素
        var contentNodes = document.querySelectorAll("#wrap .content .tap-wrap .tap-content")
        // 获取父元素宽度
        var w = wrap.offsetWidth;
        console.log(w)
        // 创建循环遍历所有content
        for (var i = 0; i < contentNodes.length; i++) {
          move(contentNodes[i]);
        }//for end
        // 移动函数
        function move(content) {
          //  将当前content移动到中间页标签
          webtools.css(content, "translateX", -w);
           //11:小绿块
           var now = 0;
          //11.1:找自己区域内小绿块
          var smallG = content.parentNode.querySelector(".tap-nav .smallG");
          //11.2:找自己区域内a
          var aNodes = content.parentNode.querySelectorAll(".tap-nav a");
          //11.3:获取第一个a元素宽度赋值小绿块
          smallG.style.width = aNodes[0].offsetWidth + "px";
        
          //17 滑动操作
          //1 创建变量保存点击开始位置
          var startPoint = { X: 0, Y: 0 }
          //2 保存元素位置
          var elementPoint = { x: 0, y: 0 }
          //3 保存水平方向操作
          var isX = true;
          //4 保存第一次滑动操作方向
          var isFirst = true;
          //5 为当前content绑定事件touchstart

          //创建是否进行跳转操作 
          var isOver = false
          content.addEventListener("touchstart", function (ev) {
            // 第一次拦截正在跳转时对多次操作
            if (isOver) {
              return;
            }
            ev = ev || event;
            var touchC = ev.changedTouches[0];
            // 手指位置
            startPoint.x = touchC.clientX;
            startPoint.y = touchC.clientY;
            // 元素位置
            elementPoint.x = webtools.css(content, "translateX");
            elementPoint.y = webtools.css(content, "translateY");
            console.log(elementPoint.y)
            // isx isfrist初始值
            isX = true;
            isFirst = true;
            // console.log(startPoint)
            // console.log(elementPoint)
            //6 为当前concent绑定touchsmove
          });
          content.addEventListener("touchmove", function (ev) {
            // 第二次拦截
            if (isOver) {
              return;
            }
            if (!isX) {  // 第一次阻止垂直滑动方向
              return;
            }
            ev = ev || event;
            var touchC = ev.changedTouches[0];
            // 创建变量保存当前位置 保存距离
            var nowPoint = { x: 0, y: 0 };
            var dis = { x: 0, y: 0 }
            nowPoint.x = touchC.clientX;
            nowPoint.y = touchC.clientY;
            // 计算距离
            dis.x = nowPoint.x - startPoint.x;
            dis.y = nowPoint.y - startPoint.y;
            //  console.log(dis)
            // 判断
            // 判断是不是首次滑动
            // 将isfrist = false
            if (isFirst) {
              isFirst = false;
              if (Math.abs(dis.y) > Math.abs(dis.x)) {
                isX = false;
              }
            }
            //获取位置
            var translateX = elementPoint.x + dis.x;
            // 为content指定translatex值 
            webtools.css(content, "translateX", translateX)


            // 跳转不同标签的函数
            jump(dis.x)
          });



          //7 为当前concent绑定事件touchend
          content.addEventListener("touchend", function (ev) {
            // 第三次阻止跳转
            if (isOver) {
              return;
            }
            ev = ev || event;
            var touchC = ev.changedTouches[0];
            // 创建新位置距离
            var nowPoint = { x: 0, y: 0 };
            var dis = { x: 0, y: 0 }
            // 获取位置与距离
            nowPoint.x = touchC.clientX;
            dis.x = nowPoint.x - startPoint.x;
            // console.log(dis.x)
            // 是否超过一半
            if (Math.abs(dis.x) > w / 2) {
              content.style.transition = "1s transform";
              webtools.css(content, "translateX", -w)
            }
          });

          function jump(disX) {
            if (isOver) {
              return;
            }

            if (Math.abs(disX) > w / 2) {
              isOver = true;
              // console.log(123)
              // 右滑动显示[0]
              // 左滑显示[-2*w]
              var translateX = disX > 0 ? 0 : -w * 2;
              content.style.transition = "1s transform";
              webtools.css(content, "translateX", translateX)

              // 任务动态加载数据
              // 为content元素绑定事件过渡结束
              content.addEventListener("transitionend", endFn);
              content.addEventListener("webkitTansitionEnd", endFn);
              // 创建函数 endFn
              function endFn() {
                // 清除绑定事件
                content.removeEventListener("transitionend", endFn);
                content.removeEventListener("webkitTansitionEnd", endFn);
                // 清除过渡效果
                content.style.transition = "none"
                // 将所有loading 显示
                var loadings = document.querySelectorAll("#wrap .content .tap-wrap .tap-content .tap-loading");
                for (var i = 0; i < loadings.length; i++) {
                  loadings[i].style.opacity = 1;//显示过渡图片
                }
                //  获取当前小绿块滑动方向
                disX > 0 ? now-- : now++;
                // 边界判断<0 最后
                if (now < 0) {//小于0跳到最后一个上
                  now = aNodes.length - 1;
                } else if (now > aNodes.length - 1) {//到达边界就跳到0位置
                  now = 0
                }
                // 11、5小绿块的位置
                webtools.css(smallG, "translateX", aNodes[now].offsetLeft);
                // 重新计算小绿块 的宽度
                if (aNodes[now].offsetWidth != smallG.offsetWidth) {
                  smallG.style.width = aNodes[now].offsetWidth + "px"
                }
                // 发送ajax请求获取动态数据使用setTimeout替换
                setTimeout(function () {
                  for (var i = 0; i < loadings.length; i++) {
                    loadings[i].style.opacity = 0;//数据回来就隐藏图片显示内容
                  }
                  //切换回中间页
                  webtools.css(content, "translateX", -w);
                  isOver = false;//内容显示了完了可以执行跳转操作
                }, 2000)
                // 接收服务器返回数据
                // 将loading隐藏
                // isover = false 允许再次跳转
              }
            }
          }
        }
      }
    }//window.onload end    
  </script>
</body>

</html>